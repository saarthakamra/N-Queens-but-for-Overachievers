<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D N×N×N Queens Puzzle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="startScreen">
      <h1>3D Queens</h1>
      <p class="instructions">
        Place as many queens as possible without any attacking each other.
        <br /><br />
        <b>Controls:</b><br />
        <span class="desktop-controls">
          Click a cell to place/remove a queen.<br />
          Click and drag to rotate the cube.<br />
          Use <kbd>Arrow Keys</kbd> to slice layers. <kbd>R</kbd> to reset
          view.<br />
          Press <kbd>C</kbd> for a creative sandbox mode.
        </span>
        <span class="mobile-controls">
          Tap a cell to place/remove a queen.<br />
          Drag with one finger to rotate.<br />
          Pinch with two fingers to zoom.<br />
          Use the on-screen arrows to slice layers.
        </span>
      </p>
      <br />
      <button class="btn" id="startGameBtn" style="width: auto; height: auto">
        Begin
      </button>
    </div>

    <div id="notification-bar"></div>

    <div class="ui-container">
      <div class="ui-block controls-top-left">
        <button class="btn icon-only" id="assistModeBtn" title="Toggle Hints">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            <path d="M12 6a6 6 0 1 1-3.34 10.03"></path>
            <path d="M12 9a3 3 0 1 1-1.67 5.01"></path>
          </svg>
        </button>
        <div id="layerInfo"></div>
      </div>

      <div class="ui-block game-header">
        <div class="level-title" id="levelTitle">Level 1</div>
        <div class="queens-counter">
          Queens: <span id="queensCount">0</span>
        </div>
        <div id="conflict-indicators"></div>
      </div>

      <div class="ui-block controls-top-right">
        <div class="level-progress">
          Personal Best: <span class="personal-best" id="personalBest">0</span>
        </div>
        <div style="font-size: 14px; color: #cccccc; margin-bottom: 10px">
          Target: <span id="targetQueens">1</span>
        </div>
        <div class="level-navigation">
          <button class="btn" id="prevLevelBtn">&lt;</button>
          <input type="number" id="levelInput" value="1" min="1" />
          <button class="btn" id="nextLevelNavBtn">&gt;</button>
        </div>
      </div>

      <div class="bottom-bar">
        <div class="controls-bottom-left">
          <button class="btn" id="dPadToggleBtn" title="Toggle Layer Controls">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M9 18l6-6-6-6" />
            </svg>
          </button>
        </div>

        <div class="layer-controls">
          <button class="up" title="Hide Top Layer [ArrowUp]">↑</button>
          <button class="left" title="Hide Left Layer [ArrowLeft]">←</button>
          <button class="reset" title="Reset View [R]">R</button>
          <button class="right" title="Hide Right Layer [ArrowRight]">→</button>
          <button class="down" title="Hide Bottom Layer [ArrowDown]">↓</button>
        </div>

        <div class="controls-bottom-right">
          <button
            class="btn icon-only"
            id="restoreSessionBtn"
            title="Restore Last Session"
          >
            ★
          </button>
          <button class="btn" id="resetBtn" title="Reset Level">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="23 4 23 10 17 10"></polyline>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
          </button>
          <button class="btn" id="creativeModeBtn" title="Creative Mode [C]">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
            </svg>
          </button>
          <button
            class="btn next-level-btn"
            id="nextLevelBtn"
            title="Next Level"
            disabled
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <canvas id="canvas"></canvas>

    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/",
          "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
          "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
          "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"
        }
      }
    </script>
    <script type="module" src="script.js"></script>
  </body>
</html>
